var notifTimes=new Array();var settings;var notifications=new Array();var inCircles=new Array();var openedTabs=new Array();var pendingTabs=new Array();chrome.tabs.onRemoved.addListener(function(b,a){var d=new Array();var e=false;for(var c=0;c<openedTabs.length;c++){if(b!=openedTabs[c]){d.push(openedTabs[c])}else{e=true}}openedTabs=d});function checkForValidUrl(d,k,g){var e="plus.google.com";if(k.status=="complete"){if(g.url.indexOf(e)>-1&&g.url.indexOf(e+"/url?")==-1){var l=verifyFirstTimeUse();if(l&&!isOldVersionSuperior("1.2.9")){localStorage.gnc="";historyCache=null;var h=new Settings();h.save()}if(l){var h=new Settings();h.get();h.save()}var b="";verified=false;chrome.pageAction.show(d);var c=new RegExp("^https?:\\/\\/plus\\.google\\.com\\/[a-zA-Z0-9/]*\\/*games/","i");var f=new RegExp("^https?:\\/\\/plus\\.google\\.com\\/[a-zA-Z0-9/]*\\/*games","i");var m=new RegExp("^https?:\\/\\/plus\\.google\\.com\\/[a-zA-Z0-9/]*\\/*circles","i");var a=new RegExp("^https?:\\/\\/plus\\.google\\.com\\/[a-zA-Z0-9/]*\\/*games/directory","i");if(g.url.match(a)){chrome.tabs.sendRequest(d,{action:"gdUpdated",globalNotif:b})}if(g.url.match(f)&&!g.url.match(c)){chrome.tabs.sendRequest(d,{action:"streamUpdated",globalNotif:b})}else{if(g.url.indexOf(e)>-1&&g.url.indexOf("games/notifications")>-1){chrome.tabs.sendRequest(d,{action:"notificationsUpdated"})}else{chrome.tabs.sendRequest(d,{action:"otherUpdated"})}}var n=false;for(var j=0;j<inCircles.length;j++){entry=inCircles[j];if(entry.tabId==d){if(g.url.match(m)){entry.res=true}else{entry.res=false}n=true}}if(!n){entry=new Object();entry.tabId=d;if(g.url.match(m)){entry.res=true}else{entry.val=false}inCircles.push(entry)}}updateNotifs()}}function updateNotifs(){for(var d=0;d<notifTimes.length;d++){clearTimeout(notifTimes[d])}notifTimes=new Array();notifications=new Array();settings=new Settings();settings.get();if(settings.allow_notifications){notifications=getAllNotificationTimes();for(var d=0;d<notifications.length;d++){var c=new Date().getTime();var b=notifications[d].notificationTime-c;var a=setTimeout("notify(notifications["+d+"])",notifications[d].notificationTime-c);notifTimes.push(a)}}}var selectedTab;chrome.tabs.onActiveChanged.addListener(function(a,b){chrome.tabs.get(a,function(d){var c="plus.google.com";if(d.url.indexOf(c)>-1){selectedTab=d.id}})});var tabs=new Array();chrome.extension.onRequest.addListener(function(h,k,d){if(h.action=="updateNotifications"){updateNotifs();for(var l=0;l<tabs.length;l++){var f=new Settings();f.get();var a=JSON.stringify(f);var p=new GameSettings();p.get();var n=JSON.stringify(p);chrome.tabs.sendRequest(tabs[l],{action:"sendSettings",settings:a,gsettings:n,games:false})}}if(h.action=="openOptions"){var b=chrome.extension.getURL("options.html");if(h.type=="gs"){b+="?type=gs&limit="+h.limit+"&delay="+h.delay+"&autoHide="+h.autoHide+"&plusOne="+h.plusOne+"&reverse="+h.reverse}else{b+="?type=n&limit="+h.limit+"&delay="+h.delay+"&autoHide="+h.autoHide+"&reverse="+h.reverse}chrome.tabs.create({url:b,index:k.tab.index+1,selected:true})}if(h.action=="openFiltersPage"){var b=chrome.extension.getURL("filters.html");chrome.tabs.create({url:b,index:k.tab.index+1,selected:true})}if(h.action=="getSettings"){var f=new Settings();f.get();var a=JSON.stringify(f);var p=new GameSettings();p.get();var n=JSON.stringify(p);tabs.push(k.tab.id);chrome.tabs.sendRequest(k.tab.id,{action:"sendSettings",settings:a,gsettings:n,games:false})}if(h.action=="getOpenedPage"){chrome.tabs.get(selectedTab,function(j){var t=new RegExp("^https?:\\/\\/plus\\.google\\.com\\/[a-zA-Z0-9/]*\\/*circles","i");var i;if(j.url.match(t)){i=true}else{i=false}chrome.extension.sendRequest({action:"sendCurrentPage",inCircle:i})})}if(h.action=="changeLastFilter"){var p=new GameSettings();p.get();for(var l=0;l<p.games.length;l++){if(p.games[l].slugName==h.game){for(var g=0;g<p.games[l].filters.length;g++){if(p.games[l].filters[g].name==h.filter&&p.games[l].filters[g].type==h.type){if(p.games[l].filters[g].type=="gs"){p.games[l].lastFilterGS=p.games[l].filters[g]}else{p.games[l].lastFilterN=p.games[l].filters[g]}}}}}p.save();var f=new Settings();f.get();var a=JSON.stringify(f);var n=JSON.stringify(p);chrome.tabs.sendRequest(k.tab.id,{action:"sendSettings",settings:a,gsettings:n,games:false})}if(h.action=="saveGamesSettings"){var f=new Settings();f.get();f.games_settings=h.games;f.save()}if(h.action=="addPresetSettings"){var p=new GameSettings();p.get();var c=new Filter();c.decode(JSON.stringify(h.filter));var q=new GameS();q.slugName=h.game;for(var l=0;l<p.games.length;l++){if(p.games[l].slugName==h.game){q=p.games[l];p.games.splice(l,1)}}for(var l=0;l<q.filters.length;l++){if(q.filters[l].name==c.name){q.filters.splice(l,1)}}if(c.type=="gs"){q.lastFilterGS=c}else{q.lastFilterN=c}q.filters.push(c);p.games.push(q);p.save();var n=JSON.stringify(p);var f=new Settings();f.get();var a=JSON.stringify(f);chrome.tabs.sendRequest(k.tab.id,{action:"sendSettings",settings:a,gsettings:n,games:false,selectedGame:q.slugName})}if(h.action=="delPresetSettings"){var p=new GameSettings();p.get();for(var l=0;l<p.games.length;l++){if(p.games[l].slugName==h.game){for(var g=0;g<p.games[l].filters.length;g++){if(p.games[l].filters[g].name==h.filter&&p.games[l].filters[g].type==h.type){p.games[l].filters.splice(g,1)}}}}p.save();var n=JSON.stringify(p);var f=new Settings();f.get();var a=JSON.stringify(f);chrome.tabs.sendRequest(k.tab.id,{action:"sendSettings",settings:a,gsettings:n,games:false})}if(h.action=="saveGameSettings"){var f=new Settings();f.get();var e=f.games_settings;q=h.game;var r=new Game();var o=0;var s=false;for(var l=0;l<e.length;l++){if(e[l].slugName==q.slugName){r=e[l];o=l;s=true}}if(!s){var m=new Game();m.name=q.name;m.slugName=q.slugName;e.push(m);o=e.length-1}if(h.type=="gs"){e[o].s_filterOut=q.s_filterOut;e[o].s_filterIn=q.s_filterIn}if(h.type=="n"){e[o].n_filterOut=q.n_filterOut;e[o].n_filterIn=q.n_filterIn}f.games_settings=e;f.save();var a=JSON.stringify(f);chrome.tabs.sendRequest(k.tab.id,{action:"sendSettings",settings:a,games:true})}});var notification;function notify(b){var a=" custom ";if(b.autoNotif){a="n automatic "}notification=window.webkitNotifications.createHTMLNotification("notification.html?msg="+b.name+"&autonotif="+a);b.notificationTime=b.time;saveHistoryEntry(b,false);showNotification()}function showNotification(){notification.show();setTimeout("hideNotification()",settings.notification_time*1000)}function hideNotification(){notification.cancel()}chrome.extension.onRequest.addListener(function(c,b,a){if(c.action=="openNotifTab"){chrome.tabs.create({url:c.url,selected:false})}});chrome.tabs.onUpdated.addListener(checkForValidUrl);